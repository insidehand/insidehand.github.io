<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>å¦å¤–ä¸€ç¨®æ–¹å¼çš„ä¾è³´æ§åˆ¶ | Insidehand</title>
<meta name="keywords" content="Swift, Dependency, Global Variable">
<meta name="description" content="ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ ä»»ä½•ä½ ä¸èƒ½æ§åˆ¶çš„ç‰©ä»¶ï¼Œéƒ½æ˜¯éš±è—çš„ä¾è³´
å…·é«”ä¾†èªªï¼Œå¦‚æœç¨‹å¼å®Œå…¨ä¸å¯«æ¸¬è©¦ï¼Œé‚£éº¼å…¶å¯¦å°±ä¸ç”¨è€ƒæ…®ä¾è³´çš„å•é¡Œã€‚
è¦ç®¡ç†ä¾è³´çš„ç†ç”±åœ¨æ–¼çµ¦æ¸¬è©¦ä¸€å€‹ä»‹å…¥çš„é€”å¾‘ã€‚
ä¾‹å¦‚èªªæœ‰ä¸€å€‹ç‰©ä»¶æ˜¯ç”¨ä¾†è¿½è¹¤è–èª•è€äººï¼Œè£¡é¢åˆ¤æ–·ä»–æœ‰æ²’æœ‰ä¸Šç­ã€‚
struct SantaClausTracker { func isWorking() -&gt; Bool { let today = Date() let month = Calendar.current.components(.month, today) let day = Calendar.current.components(.day, today) return month == 12 &amp;&amp; day == 25 } } é¡¯ç„¶ï¼Œè¦é€™å€‹æ–¹æ³•å›å‚³trueçš„è©±ï¼Œå°±åªèƒ½åœ¨è–èª•ç¯€ç•¶å¤©é€²è¡Œæ¸¬è©¦ã€‚ å…¶ä»–æ—¥å­å›å‚³éƒ½æ˜¯falseã€‚
é€™å€‹æ–¹æ³•è£¡é¢æœ‰å…©å€‹ä¾è³´ï¼Œä¸€å€‹æ˜¯Date()ï¼Œå¦ä¸€å€‹å‰‡æ˜¯Calendar.currentã€‚ å¦‚æœæƒ³è¦æŠŠé€™äº›ä¾è³´è®Šå¾—å¯æ§ï¼Œé‚£éº¼å°±æ˜¯è¦é€éå¤–éƒ¨å‚³å…¥ã€‚ä¹Ÿå°±æ˜¯ä¾è³´æ³¨å…¥ï¼ˆdependency injectionï¼‰
å‚³çµ±çš„æ–¹æ³•æœ‰ä¸‰ï¼š
å»ºæ§‹å­æ³¨å…¥ å±¬æ€§æ³¨å…¥ æ–¹æ³•åƒæ•¸æ³¨å…¥ åç¨±æ‡‰è©²è¶³ä»¥æè¿°ç›¸å°æ‡‰çš„è¡Œç‚ºï¼Œå°±ä¸å¤šè´…è¿°äº†ã€‚
æ›è¨€ä¹‹ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œåªè¦æ˜¯ä½¿ç”¨çš„ç‰©ä»¶ï¼Œéƒ½è¦è¨˜å¾—å¯ä»¥æ›¿æ›ã€‚ èˆ‰å€‹ä¾‹å­
(X func somefunction() { Date() } (O func somefunction(date: Date) { date } (X func somefunction() { URLSession.share } (ğŸ”º func somefunction(session: URLSession) { session } é‚£éº¼ï¼Œé¡¯ç„¶æœƒå‡ºç¾çš„å•é¡Œå°±æ˜¯ã€Œä¾è³´è¦æ€éº¼ä¾†ã€">
<meta name="author" content="">
<link rel="canonical" href="/posts/article/2021-10-11-%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A8%AE%E6%96%B9%E5%BC%8F%E7%9A%84%E4%BE%9D%E8%B3%B4%E6%8E%A7%E5%88%B6/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d7fb4cbf980fe688a21621b06a795933c4e6bb2d4070ec940667af1715d84af2.css" integrity="sha256-1/tMv5gP5oiiFiGwanlZM8Tmuy1AcOyUBmevFxXYSvI=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="/posts/article/2021-10-11-%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A8%AE%E6%96%B9%E5%BC%8F%E7%9A%84%E4%BE%9D%E8%B3%B4%E6%8E%A7%E5%88%B6/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="å¦å¤–ä¸€ç¨®æ–¹å¼çš„ä¾è³´æ§åˆ¶" />
<meta property="og:description" content="ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ ä»»ä½•ä½ ä¸èƒ½æ§åˆ¶çš„ç‰©ä»¶ï¼Œéƒ½æ˜¯éš±è—çš„ä¾è³´
å…·é«”ä¾†èªªï¼Œå¦‚æœç¨‹å¼å®Œå…¨ä¸å¯«æ¸¬è©¦ï¼Œé‚£éº¼å…¶å¯¦å°±ä¸ç”¨è€ƒæ…®ä¾è³´çš„å•é¡Œã€‚
è¦ç®¡ç†ä¾è³´çš„ç†ç”±åœ¨æ–¼çµ¦æ¸¬è©¦ä¸€å€‹ä»‹å…¥çš„é€”å¾‘ã€‚
ä¾‹å¦‚èªªæœ‰ä¸€å€‹ç‰©ä»¶æ˜¯ç”¨ä¾†è¿½è¹¤è–èª•è€äººï¼Œè£¡é¢åˆ¤æ–·ä»–æœ‰æ²’æœ‰ä¸Šç­ã€‚
struct SantaClausTracker { func isWorking() -&gt; Bool { let today = Date() let month = Calendar.current.components(.month, today) let day = Calendar.current.components(.day, today) return month == 12 &amp;&amp; day == 25 } } é¡¯ç„¶ï¼Œè¦é€™å€‹æ–¹æ³•å›å‚³trueçš„è©±ï¼Œå°±åªèƒ½åœ¨è–èª•ç¯€ç•¶å¤©é€²è¡Œæ¸¬è©¦ã€‚ å…¶ä»–æ—¥å­å›å‚³éƒ½æ˜¯falseã€‚
é€™å€‹æ–¹æ³•è£¡é¢æœ‰å…©å€‹ä¾è³´ï¼Œä¸€å€‹æ˜¯Date()ï¼Œå¦ä¸€å€‹å‰‡æ˜¯Calendar.currentã€‚ å¦‚æœæƒ³è¦æŠŠé€™äº›ä¾è³´è®Šå¾—å¯æ§ï¼Œé‚£éº¼å°±æ˜¯è¦é€éå¤–éƒ¨å‚³å…¥ã€‚ä¹Ÿå°±æ˜¯ä¾è³´æ³¨å…¥ï¼ˆdependency injectionï¼‰
å‚³çµ±çš„æ–¹æ³•æœ‰ä¸‰ï¼š
å»ºæ§‹å­æ³¨å…¥ å±¬æ€§æ³¨å…¥ æ–¹æ³•åƒæ•¸æ³¨å…¥ åç¨±æ‡‰è©²è¶³ä»¥æè¿°ç›¸å°æ‡‰çš„è¡Œç‚ºï¼Œå°±ä¸å¤šè´…è¿°äº†ã€‚
æ›è¨€ä¹‹ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œåªè¦æ˜¯ä½¿ç”¨çš„ç‰©ä»¶ï¼Œéƒ½è¦è¨˜å¾—å¯ä»¥æ›¿æ›ã€‚ èˆ‰å€‹ä¾‹å­
(X func somefunction() { Date() } (O func somefunction(date: Date) { date } (X func somefunction() { URLSession.share } (ğŸ”º func somefunction(session: URLSession) { session } é‚£éº¼ï¼Œé¡¯ç„¶æœƒå‡ºç¾çš„å•é¡Œå°±æ˜¯ã€Œä¾è³´è¦æ€éº¼ä¾†ã€" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/article/2021-10-11-%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A8%AE%E6%96%B9%E5%BC%8F%E7%9A%84%E4%BE%9D%E8%B3%B4%E6%8E%A7%E5%88%B6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-11T17:41:32&#43;08:00" />
<meta property="article:modified_time" content="2021-10-11T17:41:32&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å¦å¤–ä¸€ç¨®æ–¹å¼çš„ä¾è³´æ§åˆ¶"/>
<meta name="twitter:description" content="ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ ä»»ä½•ä½ ä¸èƒ½æ§åˆ¶çš„ç‰©ä»¶ï¼Œéƒ½æ˜¯éš±è—çš„ä¾è³´
å…·é«”ä¾†èªªï¼Œå¦‚æœç¨‹å¼å®Œå…¨ä¸å¯«æ¸¬è©¦ï¼Œé‚£éº¼å…¶å¯¦å°±ä¸ç”¨è€ƒæ…®ä¾è³´çš„å•é¡Œã€‚
è¦ç®¡ç†ä¾è³´çš„ç†ç”±åœ¨æ–¼çµ¦æ¸¬è©¦ä¸€å€‹ä»‹å…¥çš„é€”å¾‘ã€‚
ä¾‹å¦‚èªªæœ‰ä¸€å€‹ç‰©ä»¶æ˜¯ç”¨ä¾†è¿½è¹¤è–èª•è€äººï¼Œè£¡é¢åˆ¤æ–·ä»–æœ‰æ²’æœ‰ä¸Šç­ã€‚
struct SantaClausTracker { func isWorking() -&gt; Bool { let today = Date() let month = Calendar.current.components(.month, today) let day = Calendar.current.components(.day, today) return month == 12 &amp;&amp; day == 25 } } é¡¯ç„¶ï¼Œè¦é€™å€‹æ–¹æ³•å›å‚³trueçš„è©±ï¼Œå°±åªèƒ½åœ¨è–èª•ç¯€ç•¶å¤©é€²è¡Œæ¸¬è©¦ã€‚ å…¶ä»–æ—¥å­å›å‚³éƒ½æ˜¯falseã€‚
é€™å€‹æ–¹æ³•è£¡é¢æœ‰å…©å€‹ä¾è³´ï¼Œä¸€å€‹æ˜¯Date()ï¼Œå¦ä¸€å€‹å‰‡æ˜¯Calendar.currentã€‚ å¦‚æœæƒ³è¦æŠŠé€™äº›ä¾è³´è®Šå¾—å¯æ§ï¼Œé‚£éº¼å°±æ˜¯è¦é€éå¤–éƒ¨å‚³å…¥ã€‚ä¹Ÿå°±æ˜¯ä¾è³´æ³¨å…¥ï¼ˆdependency injectionï¼‰
å‚³çµ±çš„æ–¹æ³•æœ‰ä¸‰ï¼š
å»ºæ§‹å­æ³¨å…¥ å±¬æ€§æ³¨å…¥ æ–¹æ³•åƒæ•¸æ³¨å…¥ åç¨±æ‡‰è©²è¶³ä»¥æè¿°ç›¸å°æ‡‰çš„è¡Œç‚ºï¼Œå°±ä¸å¤šè´…è¿°äº†ã€‚
æ›è¨€ä¹‹ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œåªè¦æ˜¯ä½¿ç”¨çš„ç‰©ä»¶ï¼Œéƒ½è¦è¨˜å¾—å¯ä»¥æ›¿æ›ã€‚ èˆ‰å€‹ä¾‹å­
(X func somefunction() { Date() } (O func somefunction(date: Date) { date } (X func somefunction() { URLSession.share } (ğŸ”º func somefunction(session: URLSession) { session } é‚£éº¼ï¼Œé¡¯ç„¶æœƒå‡ºç¾çš„å•é¡Œå°±æ˜¯ã€Œä¾è³´è¦æ€éº¼ä¾†ã€"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "å¦å¤–ä¸€ç¨®æ–¹å¼çš„ä¾è³´æ§åˆ¶",
      "item": "/posts/article/2021-10-11-%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A8%AE%E6%96%B9%E5%BC%8F%E7%9A%84%E4%BE%9D%E8%B3%B4%E6%8E%A7%E5%88%B6/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "å¦å¤–ä¸€ç¨®æ–¹å¼çš„ä¾è³´æ§åˆ¶",
  "name": "å¦å¤–ä¸€ç¨®æ–¹å¼çš„ä¾è³´æ§åˆ¶",
  "description": "ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ ä»»ä½•ä½ ä¸èƒ½æ§åˆ¶çš„ç‰©ä»¶ï¼Œéƒ½æ˜¯éš±è—çš„ä¾è³´\nå…·é«”ä¾†èªªï¼Œå¦‚æœç¨‹å¼å®Œå…¨ä¸å¯«æ¸¬è©¦ï¼Œé‚£éº¼å…¶å¯¦å°±ä¸ç”¨è€ƒæ…®ä¾è³´çš„å•é¡Œã€‚\nè¦ç®¡ç†ä¾è³´çš„ç†ç”±åœ¨æ–¼çµ¦æ¸¬è©¦ä¸€å€‹ä»‹å…¥çš„é€”å¾‘ã€‚\nä¾‹å¦‚èªªæœ‰ä¸€å€‹ç‰©ä»¶æ˜¯ç”¨ä¾†è¿½è¹¤è–èª•è€äººï¼Œè£¡é¢åˆ¤æ–·ä»–æœ‰æ²’æœ‰ä¸Šç­ã€‚\nstruct SantaClausTracker { func isWorking() -\u0026gt; Bool { let today = Date() let month = Calendar.current.components(.month, today) let day = Calendar.current.components(.day, today) return month == 12 \u0026amp;\u0026amp; day == 25 } } é¡¯ç„¶ï¼Œè¦é€™å€‹æ–¹æ³•å›å‚³trueçš„è©±ï¼Œå°±åªèƒ½åœ¨è–èª•ç¯€ç•¶å¤©é€²è¡Œæ¸¬è©¦ã€‚ å…¶ä»–æ—¥å­å›å‚³éƒ½æ˜¯falseã€‚\né€™å€‹æ–¹æ³•è£¡é¢æœ‰å…©å€‹ä¾è³´ï¼Œä¸€å€‹æ˜¯Date()ï¼Œå¦ä¸€å€‹å‰‡æ˜¯Calendar.currentã€‚ å¦‚æœæƒ³è¦æŠŠé€™äº›ä¾è³´è®Šå¾—å¯æ§ï¼Œé‚£éº¼å°±æ˜¯è¦é€éå¤–éƒ¨å‚³å…¥ã€‚ä¹Ÿå°±æ˜¯ä¾è³´æ³¨å…¥ï¼ˆdependency injectionï¼‰\nå‚³çµ±çš„æ–¹æ³•æœ‰ä¸‰ï¼š\nå»ºæ§‹å­æ³¨å…¥ å±¬æ€§æ³¨å…¥ æ–¹æ³•åƒæ•¸æ³¨å…¥ åç¨±æ‡‰è©²è¶³ä»¥æè¿°ç›¸å°æ‡‰çš„è¡Œç‚ºï¼Œå°±ä¸å¤šè´…è¿°äº†ã€‚\næ›è¨€ä¹‹ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œåªè¦æ˜¯ä½¿ç”¨çš„ç‰©ä»¶ï¼Œéƒ½è¦è¨˜å¾—å¯ä»¥æ›¿æ›ã€‚ èˆ‰å€‹ä¾‹å­\n(X func somefunction() { Date() } (O func somefunction(date: Date) { date } (X func somefunction() { URLSession.share } (ğŸ”º func somefunction(session: URLSession) { session } é‚£éº¼ï¼Œé¡¯ç„¶æœƒå‡ºç¾çš„å•é¡Œå°±æ˜¯ã€Œä¾è³´è¦æ€éº¼ä¾†ã€",
  "keywords": [
    "Swift", "Dependency", "Global Variable"
  ],
  "articleBody": "ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ ä»»ä½•ä½ ä¸èƒ½æ§åˆ¶çš„ç‰©ä»¶ï¼Œéƒ½æ˜¯éš±è—çš„ä¾è³´\nå…·é«”ä¾†èªªï¼Œå¦‚æœç¨‹å¼å®Œå…¨ä¸å¯«æ¸¬è©¦ï¼Œé‚£éº¼å…¶å¯¦å°±ä¸ç”¨è€ƒæ…®ä¾è³´çš„å•é¡Œã€‚\nè¦ç®¡ç†ä¾è³´çš„ç†ç”±åœ¨æ–¼çµ¦æ¸¬è©¦ä¸€å€‹ä»‹å…¥çš„é€”å¾‘ã€‚\nä¾‹å¦‚èªªæœ‰ä¸€å€‹ç‰©ä»¶æ˜¯ç”¨ä¾†è¿½è¹¤è–èª•è€äººï¼Œè£¡é¢åˆ¤æ–·ä»–æœ‰æ²’æœ‰ä¸Šç­ã€‚\nstruct SantaClausTracker { func isWorking() -\u003e Bool { let today = Date() let month = Calendar.current.components(.month, today) let day = Calendar.current.components(.day, today) return month == 12 \u0026\u0026 day == 25 } } é¡¯ç„¶ï¼Œè¦é€™å€‹æ–¹æ³•å›å‚³trueçš„è©±ï¼Œå°±åªèƒ½åœ¨è–èª•ç¯€ç•¶å¤©é€²è¡Œæ¸¬è©¦ã€‚ å…¶ä»–æ—¥å­å›å‚³éƒ½æ˜¯falseã€‚\né€™å€‹æ–¹æ³•è£¡é¢æœ‰å…©å€‹ä¾è³´ï¼Œä¸€å€‹æ˜¯Date()ï¼Œå¦ä¸€å€‹å‰‡æ˜¯Calendar.currentã€‚ å¦‚æœæƒ³è¦æŠŠé€™äº›ä¾è³´è®Šå¾—å¯æ§ï¼Œé‚£éº¼å°±æ˜¯è¦é€éå¤–éƒ¨å‚³å…¥ã€‚ä¹Ÿå°±æ˜¯ä¾è³´æ³¨å…¥ï¼ˆdependency injectionï¼‰\nå‚³çµ±çš„æ–¹æ³•æœ‰ä¸‰ï¼š\nå»ºæ§‹å­æ³¨å…¥ å±¬æ€§æ³¨å…¥ æ–¹æ³•åƒæ•¸æ³¨å…¥ åç¨±æ‡‰è©²è¶³ä»¥æè¿°ç›¸å°æ‡‰çš„è¡Œç‚ºï¼Œå°±ä¸å¤šè´…è¿°äº†ã€‚\næ›è¨€ä¹‹ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œåªè¦æ˜¯ä½¿ç”¨çš„ç‰©ä»¶ï¼Œéƒ½è¦è¨˜å¾—å¯ä»¥æ›¿æ›ã€‚ èˆ‰å€‹ä¾‹å­\n(X func somefunction() { Date() } (O func somefunction(date: Date) { date } (X func somefunction() { URLSession.share } (ğŸ”º func somefunction(session: URLSession) { session } é‚£éº¼ï¼Œé¡¯ç„¶æœƒå‡ºç¾çš„å•é¡Œå°±æ˜¯ã€Œä¾è³´è¦æ€éº¼ä¾†ã€\nä¾‹å¦‚èªªä¸€å€‹Appç•«é¢å †ç–Šæ˜¯é€™æ¨£\nå…ˆä¸è¨è«–ç•«é¢å±¤ç´šå¤ªæ·±çš„å•é¡Œé€™å¯ä»¥çœ‹ä¸€å€‹ç²¾å½©çš„å½±ç‰‡ã€Œè‡³ç°¡æš¢éŠ·ã€\ngraph LR View1 --\u003e View2 --\u003e View3 --\u003e View4 ä»Šå¤©View4æœ‰å‘¼å«APIçš„éœ€è¦ï¼ŒView2 , 3æ²’æœ‰ã€‚ è¦present View4åªèƒ½å¤ éView3ï¼ˆMVCï¼‰æˆ–æ˜¯View3çš„Coordinatorï¼ˆMVVM Cï¼‰ å‹¢å¿…View2, 3éƒ½å¿…é ˆè¦æ”œå¸¶ä¸€å€‹ç”¨ä¸åˆ°çš„ç‰©ä»¶ã€‚\nç•¶ä»Šå¤©åº•å±¤è¶Šå¤šï¼Œä¾è³´æ‹†åˆ†çš„è¶Šç´°ï¼Œå°±ä¸­é–“çš„å±¤ç´šå°±å®¹æ˜“è¦å‚³éä¸€äº›ç”¨ä¸åˆ°çš„ç‰©ä»¶ã€‚\nä¹…äº†å°±ä¸å®¹æ˜“ç¶­è­·ï¼Œä¸å®¹æ˜“ç¶­è­·å°±ç­‰æ–¼éš±è—çš„Bug\nä»¥å‰å¯«éé¡ä¼¼çš„ç¨‹å¼ç¢¼ï¼Œä¸­é–“å‚³éçš„åƒæ•¸å¤šäº†ï¼Œå°±éœ€è¦ä½¿ç”¨DTOä¾†æ‰“åŒ…ï¼Œå¤šä¸€å±¤åˆé¡¯å¾—å†—ä½™ã€‚\né€™æ™‚å€™å°±çœ‹åˆ°ä¸€å€‹çªç ´å¤©éš›çš„æƒ³æ³•How to control the World\nå¼·çƒˆå»ºè­°çœ‹å½±ç‰‡\nå¼·çƒˆå»ºè­°çœ‹å½±ç‰‡\nå¼·çƒˆå»ºè­°çœ‹å½±ç‰‡\nå…ˆä¾†çœ‹çœ‹å¯¦ä½œï¼ŒæŠŠéœ€è¦çš„ä¾è³´å®£å‘Šåœ¨ä¸€å€‹structä¸­\nstruct World { var date = { Date() } } é€™é‚Šè¦æ³¨æ„çš„æ˜¯ä¸¦ä¸æ˜¯é€éã€Œæ–¹æ³•ã€ä¾†å–å€¼ï¼Œä¾‹å¦‚èªª func getDate() -\u003e Date { ... } å› ç‚ºæ–¹æ³•çš„å¯¦ä½œæ˜¯ä¸å¯ç•°å‹•çš„ï¼Œæœ¬è³ªä¸Šé‚„æ˜¯ä¾è³´ï¼Œåªæ˜¯æŠŠä¾è³´é›†ä¸­åˆ°ä¸€å€‹åœ°æ–¹ç®¡ç†ã€‚\nä¹Ÿä¸æ˜¯ç›´æ¥æ˜¯ä¸€å€‹Dateå±¬æ€§ å› ç‚ºç•¶ä½ å­˜å–Current.dateæ™‚ï¼Œæ¯æ¬¡å–çš„éƒ½æ˜¯ä¸ä¸€æ¨£çš„å€¼ å¦‚æœæƒ³è¦æ¯æ¬¡éƒ½å–å¾—åŒä¸€å€‹æ™‚é–“çš„è©±ï¼Œå°±åšä¸åˆ°é€™å€‹éœ€æ±‚\nç•¶ç„¶é€™é‚Šä¹Ÿå¯ä»¥æŠŠé€™å€‹structæ”¹å¯«æˆprotocolï¼Œç„¶å¾Œå¯¦ä½œä¸åŒçš„ç‰©ä»¶ä¾†æä¾›ä¸åŒçš„æ¸¬è©¦éœ€è¦ï¼Œä¸éé‚£å°±æ˜¯å¦å¤–ä¸€å›äº‹äº†ã€‚\nèªªå›æ­£é¡Œï¼Œç•¶ä½ å®£å‘Šäº†é€™æ¨£çš„structï¼Œä½ é‚„éœ€è¦ä¸€å€‹å…¨åŸŸçš„è®Šæ•¸\nvar Current = World() é€™æ˜¯ä¸€å€‹Singletonï¼çš®è«¾å¯ï¼Œé€™å€‹ç›´æ¥é›»æ­»\nåˆ¥æ€¥ï¼Œé€™æ™‚å€™é€™å€‹è¨­è¨ˆç¥çš„åœ°æ–¹ä¾†äº†ã€‚\nç”¨ä¸Šé¢çš„ç¯„ä¾‹ä¾†å¯¦ä½œçš„è©±å°±æœƒè®Šé€™æ¨£\nstruct SantaClusTracker { func isWorking() -\u003e Bool { //æš«æ™‚å…ˆæ”¹ä¸€å€‹ï¼Œbaby step let today = Current.date() let month = Calendar.current.components(.month, today) let day = Calendar.current.components(.day, today) return month == 12 \u0026\u0026 day == 25 } } å› ç‚ºCurrentæ˜¯ä¸€å€‹varï¼Œæ‰€ä»¥è£¡é¢çš„å±¬æ€§æ˜¯å¯ä»¥ç•°å‹•çš„ã€‚ å› ç‚ºdateæ˜¯ä¸€å€‹å›å‚³Dateçš„functionï¼Œæ‰€ä»¥å¯¦ä½œå…§å®¹ä¹Ÿæ˜¯å¯ä»¥ç•°å‹•çš„\nä»Šå¤©éœ€è¦æ¸¬è©¦çš„æ™‚å€™ï¼Œå¯ä»¥ç›´æ¥å°Currentè¨­å€¼ã€‚\nfunc test_Date_Is_Christmas_SantaClausTracker_isWorking_should_return_true() throws { /* 3AåŸå‰‡ï¼Œå…·é«”å¯ä»¥åƒè€ƒ91çš„æ–‡ç« æˆ–æ˜¯è½ä»–çš„èª²ï¼ç²ç›Šè‰¯å¤š */ //Arrange let target = SantaClausTracker() Current.date = { let formatter = DateFormatter() formatter.dateFormat = \"yyyy/MM/dd\" return formatter.date(string: \"2021/12/25\")! } //Action let actual = target.isWorking() //Assert let expect = true XCTAssertEqual(actual, expect) } å¦‚æ­¤ï¼Œå°±ç®—æ˜¯åœ¨å…¶ä»–æ—¥å­ï¼Œä¹Ÿèƒ½æª¢æŸ¥åœ¨è–èª•ç¯€çš„æ™‚å€™æ˜¯ä¸æ˜¯æœƒå›å‚³true\né€™é‚Šå…ˆè¨è«–å¹¾å€‹å•é¡Œ\nSingletonä¸æ˜¯ä¸å¥½ï¼Œç‚ºä»€éº¼è¦ç”¨ï¼Ÿ ç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹ï¼Ÿ å…¨åŸŸè®Šæ•¸å¾ˆå±éšªï¼Œä¸æ‡‰è©²ç”¨ä¸æ˜¯å—ï¼Ÿ Singletonä¸æ˜¯ä¸å¥½ï¼Œç‚ºä»€éº¼è¦ç”¨ï¼Ÿ Singletonä¸¦ä¸æ˜¯ä¸å¥½ï¼Œä¸å¥½çš„è©±Appleé‚„åˆ°è™•æ”¾ä¸æ˜¯å¾ˆå¥‡æ€ªï¼Ÿ\nURLSession.shared\nUserDefaults.standard\nFileManager.default\nSingletonçš„å•é¡Œåœ¨æ–¼å®ƒæ˜¯ä¸€å€‹å¯¦é«”å‹åˆ¥ï¼Œç„¡æ³•è¢«æŠ½è±¡åŒ–ã€‚ä¹Ÿå°±æ˜¯ç„¡æ³•åœ¨æ¸¬è©¦ä¸­è¢«æ›¿æ›ã€‚ç•¶ä½ ä»Šå¤©åœ¨ç¨‹å¼ç¢¼ä¸­æ”¾äº†URLSession.sharedä»¥å¾Œï¼Œå°±è¨»å®šäº†ä»–ä¸€å®šæœƒå»èµ°çœŸå¯¦çš„ç¶²è·¯ï¼ˆç”¨intercepteræ“‹æ‰å¦ç•¶åˆ¥è«–ï¼‰ï¼Œè€Œæ²’è¾¦æ³•ç”¨MockURLSessionä¾†é€²è¡Œæ›¿æ›\nç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹ï¼Ÿ åœ¨çœ‹é€™å€‹å½±ç‰‡ä¹‹å‰ï¼Œæˆ‘ä¹Ÿæ˜¯ç”¨protocolä¾†é€²è¡Œå€éš”ï¼Œé€™ä¹Ÿæœ‰ä¸€å€‹å¤§ç¥çš„æ–‡ç« å¯ä»¥åƒè€ƒæ­¡è¿ä¾†åˆ°çœŸå¯¦ä¸–ç•Œ\nå…ˆä¾†è«‡è«‡å¦‚æœç”¨ä»‹é¢éš”é–‹URLSessionï¼Œè¦åšå¤šå°‘å‹•ä½œï¼Ÿ\nè£½ä½œä¸€å€‹ä»‹é¢URLSessionProtocolï¼Œæ–¹æ³•ç°½ç« è¦è·ŸURLSessionä¸­è¦å‘¼å«çš„æ–¹æ³•ä¸€è‡´ è®“URLSessionæ“´å……URLSessionProtocolï¼Œå› ç‚ºæ–¹æ³•å·²ç¶“å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ç”¨å¦å¤–å¯¦ä½œã€‚ è£½ä½œä¸€å€‹æ¸¬è©¦åœ¨ç”¨çš„ç‰©ä»¶MockURLSessionï¼Œå¯¦ä½œä»‹é¢URLSessionProtocolï¼Œè£¡é¢ä¸æ¶‰åŠç¶²è·¯å­˜å–ï¼Œç›´æ¥å›å‚³å€¼ã€‚ å°‡åŸæœ¬ç¨‹å¼ç¢¼å‘¼å«URLSession.sharedçš„åœ°æ–¹å…¨éƒ¨æŠ½æ›æ‰ åœ¨æ¸¬è©¦ä¸­å°‡MockURLSessionæ³¨å…¥åˆ°æ¸¬è©¦ç›®æ¨™ä¸­ é¦–å…ˆï¼Œé€™å€‹åšæ³•å°ç¨‹å¼ç¢¼æ”¹å‹•å¹…åº¦æ¯”è¼ƒå¤§ï¼Œç•¶æ—©æœŸæ²’åšï¼Œå¾Œé¢è¦æŠ½æ›çš„æ™‚å€™æ”¹å‹•å¹…åº¦å°±æœƒå¾ˆå¤§ï¼Œä¹Ÿæ˜¯å­˜åœ¨é¢¨éšªã€‚\nå…¶æ¬¡ï¼Œå¦‚æœä»‹é¢è£¡é¢çš„æ–¹æ³•é–‹å§‹è®Šå¤šä»¥å¾Œï¼Œä¸€å€‹æ–°çš„Mockç‰©ä»¶å¯¦ä½œèµ·ä¾†ä¸å®¹æ˜“ã€‚\nä¾‹å¦‚èªªä¸€å€‹è³‡æ–™åº«å­˜å–ä»‹é¢ï¼Œæœ‰å››å€‹æ–¹æ³•CRUD\né‚£éº¼å»ºç«‹ä¸€å€‹æ–°çš„Mockç‰©ä»¶å°±è¦å¯¦ä½œå››å€‹æ–¹æ³•ã€‚\nè€Œä¸€å€‹æ­£å¸¸çš„ä»‹é¢æ–¹æ³•éƒ½ä¸æ­¢å››å€‹\nå…¨åŸŸè®Šæ•¸å¾ˆå±éšªï¼Œä¸æ‡‰è©²ç”¨ä¸æ˜¯å—ï¼Ÿ å…¨åŸŸè®Šæ•¸çš„å±éšªä¹‹è™•åœ¨æ–¼ã€Œä½ ä¸çŸ¥é“ä»€éº¼æ™‚å€™è¢«æ”¹å‹•ã€\nèª ç„¶ï¼Œè¨­å®šç‚ºè®Šæ•¸æ˜¯å­˜åœ¨é¢¨éšªçš„ï¼Œä½†æ˜¯ä¸æ‡‰è©²æŠŠCurrentç•¶æˆæ˜¯ä¸€å€‹å‚³éã€æš«å­˜åƒæ•¸çš„åœ°æ–¹ã€‚è€Œæ˜¯ä¸€å€‹ä¾è³´ä¿ç®¡å€ï¼ˆProductionæ™‚ï¼‰ã€ä¾è³´æ³¨å…¥å€ï¼ˆDevelopæ™‚ï¼‰\nèªªå›é€™å€‹æ–¹æ³•\nå¦‚æœä»Šå¤©è¦æ¸¬è©¦ä½¿ç”¨è€…ç™»å…¥ã€ŒæˆåŠŸã€èˆ‡ã€Œå¤±æ•—ã€çš„æƒ…å¢ƒ\nstruct UserAPIClient { func login(account: String, password: String, complectionHandler: @escaping (Bool) -\u003e Void ) { let url = URL(string: \"API Path\")! // \u003c-- é€™è£¡ä¸€å®šrun time error URLSession.shared.dataTask(with: url) { data, _, _ in complectionHandler(data == nil) } } } struct ContentView: View { @State private var loginResult: Bool = false var body: some View { Text(\"Login \\(loginResult ? \"Success\" : \"Failure\")\") .onAppear { UserAPIClient().login(account: \"account\", password: \"password\") { result in loginResult = result } } } } UserAPIClientæœ‰ä¸€å€‹ä¸€å®šæœƒåœ¨run timeç‚¸æ‰çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯URL(string: \"API Path\")!\nå‡æƒ³é€™æ˜¯Serveræš«æ™‚ä¸å¯ç”¨ï¼Œæˆ–æ˜¯ç¶²è·¯æ–·ç·šçš„æƒ…å¢ƒå§ã€‚\né‚£é€™ç¨®æ™‚å€™å°±ä¸ç”¨æ¸¬è©¦äº†å—ï¼Ÿæ²’éŒ¯ï¼å¾Œå°ä¿®å¥½å†å«æˆ‘\nç•¶ç„¶ä¸å¯èƒ½ï¼Œæ‰€ä»¥é€™æ™‚å€™å°±éœ€è¦è„«é›¢å¯¦éš›ç’°å¢ƒä¾†æ¸¬è©¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚\nç”¨protocolçš„æ–¹å¼ä¾†é€²è¡Œè„«é‰¤æ˜¯é€™æ¨£å¯¦ä½œçš„\n//1. å®šç¾©å”è­° protocol UserAPIClientProtocol { func login(account: String, password: String, complectionHandler: @escaping (Bool) -\u003e Void ) } //2. è®“åŸæœ¬çš„ç‰©ä»¶æ“´å……é€™å€‹å”è­° extension UserAPIClient: UserAPIClientProtocol { } //3. å»ºç«‹æ¸¬è©¦ç‰©ä»¶ï¼Œå› ç‚ºæ¸¬è©¦æƒ…å¢ƒæœ‰ã€ŒæˆåŠŸã€ã€Œå¤±æ•—ã€ï¼Œæ‰€ä»¥å›å‚³å€¼ç”¨å»ºæ§‹æ³¨å…¥ struct MockUserAPIClient: UserAPIClientProtocol { var loginResult: Bool func login(account: String, password: String, complectionHandler: @escaping (Bool) -\u003e Void ) { complectionHandler(loginResult) } } //4. å°‡åŸæœ¬çš„å‹åˆ¥ç”¨ä»‹é¢æŠ½æ›ï¼ˆå‘¼å«çš„æ™‚å€™è¦æ³¨å…¥ï¼‰ struct ContentView: View { var userAPIClient: UserAPIClientProtocol @State private var loginResult: Bool = false var body: some View { Text(\"Login \\(loginResult ? \"Success\" : \"Failure\")\") .onAppear { userAPIClient.login(account: \"acc\", password: \"pass\") { result in loginResult = result } } } } //5. ä¿®æ”¹å‘¼å«ç«¯ struct ContentView_Previews: PreviewProvider { static var previews: some View { ContentView(userAPIClient: MockUserAPIClient(loginResult: true)) } } å¦‚æœç”¨Worldä¾†æ§åˆ¶çš„è©±ï¼Œæ˜¯é€™å€‹æ¨£å­çš„\nstruct UserAPI { var login = UserAPIClient().login(account:password:complectionHandler:) } struct World { var userAPI = UserAPI() } var Current = World() struct ContentView: View { @State private var loginResult: Bool = false var body: some View { Text(\"Login \\(loginResult ? \"Success\" : \"Failure\")\") .onAppear { Current.userAPI.login(\"account\", \"password\") { result in loginResult = result } } } } //ä¿®æ”¹å‘¼å«ç«¯ struct ContentView_Previews: PreviewProvider { static var previews: some View { //æ­£å¸¸ä¸æœƒåœ¨é€™é‚Šä¿®æ”¹ï¼Œé€™é‚Šåªæ˜¯æ‡¶å¾—æŠŠè³‡æ–™åˆ‡ä¹¾æ·¨æ‰€ä»¥æ”¾è‘—èˆ‰ä¾‹ä¸€ä¸‹ Current.userAPI.login = { _, _, callback in callback(true) } return ContentView() } } çœ‹èµ·ä¾†æœ‰é»å·®ç•°ï¼Œä½†æ˜¯å¥½åƒåˆå·®ç•°ä¸å¤§ï¼Ÿ ç•¶ä½ å†é‡åˆ°é€™æ¨£çš„éœ€æ±‚æ™‚\ngraph LR View1 --\u003e View2 --\u003e View3 --\u003e View4 View2, 3å°±ä¸éœ€è¦æ”œå¸¶UserAPIClientè·‘ä¾†è·‘å»äº†\næœ€é‡è¦çš„æ˜¯ ç•¶ä½ çš„æ¸¬è©¦æƒ…å¢ƒéœ€è¦ä¸åŒçš„å›å‚³å€¼æ™‚ï¼Œä¸å†éœ€è¦åƒä¸Šé¢çš„MockUserAPIClientä¸€æ¨£é€éå„ç¨®æ³¨å…¥ï¼Œè€ƒæ…®å„ç¨®æ¸¬è©¦æƒ…å¢ƒè¦å‘¼å«æ–¹æ³•æ™‚çš„é€šç”¨æ€§ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥é‡å°ç‰¹å®šæ–¹æ³•æ”¹å¯«æ–¹æ³•å¯¦ä½œå…§å®¹ã€‚\nåƒè€ƒæ–‡ç« ï¼š https://vimeo.com/291588126\nhttps://www.codementor.io/koromiko/unit-test-for-networking-ahdpdqr5k\n",
  "wordCount" : "536",
  "inLanguage": "en",
  "datePublished": "2021-10-11T17:41:32+08:00",
  "dateModified": "2021-10-11T17:41:32+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/posts/article/2021-10-11-%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A8%AE%E6%96%B9%E5%BC%8F%E7%9A%84%E4%BE%9D%E8%B3%B4%E6%8E%A7%E5%88%B6/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Insidehand",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Insidehand (Alt + H)">Insidehand</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="/tw/" title="Taiwanese"
                            aria-label="Taiwanese">Tw</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="/search/" title="Search">
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="/">Home</a></div>
    <h1 class="post-title">
      å¦å¤–ä¸€ç¨®æ–¹å¼çš„ä¾è³´æ§åˆ¶
    </h1>
    <div class="post-meta"><span title='2021-10-11 17:41:32 +0800 CST'>October 11, 2021</span>&nbsp;Â·&nbsp;3 min

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%bb%80%e9%ba%bc%e6%98%af%e4%be%9d%e8%b3%b4%e7%82%ba%e4%bb%80%e9%ba%bc%e8%a6%81%e7%ae%a1%e7%90%86" aria-label="ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ">ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ</a><ul>
                        
                <li>
                    <a href="#singleton%e4%b8%8d%e6%98%af%e4%b8%8d%e5%a5%bd%e7%82%ba%e4%bb%80%e9%ba%bc%e8%a6%81%e7%94%a8" aria-label="Singletonä¸æ˜¯ä¸å¥½ï¼Œç‚ºä»€éº¼è¦ç”¨ï¼Ÿ">Singletonä¸æ˜¯ä¸å¥½ï¼Œç‚ºä»€éº¼è¦ç”¨ï¼Ÿ</a></li>
                <li>
                    <a href="#%e7%82%ba%e4%bb%80%e9%ba%bc%e4%b8%8d%e7%94%a8%e4%bb%8b%e9%9d%a2%e9%9a%94%e9%96%8b" aria-label="ç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹ï¼Ÿ">ç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹ï¼Ÿ</a></li>
                <li>
                    <a href="#%e5%85%a8%e5%9f%9f%e8%ae%8a%e6%95%b8%e5%be%88%e5%8d%b1%e9%9a%aa%e4%b8%8d%e6%87%89%e8%a9%b2%e7%94%a8%e4%b8%8d%e6%98%af%e5%97%8e" aria-label="å…¨åŸŸè®Šæ•¸å¾ˆå±éšªï¼Œä¸æ‡‰è©²ç”¨ä¸æ˜¯å—ï¼Ÿ">å…¨åŸŸè®Šæ•¸å¾ˆå±éšªï¼Œä¸æ‡‰è©²ç”¨ä¸æ˜¯å—ï¼Ÿ</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8f%83%e8%80%83%e6%96%87%e7%ab%a0" aria-label="åƒè€ƒæ–‡ç« ï¼š">åƒè€ƒæ–‡ç« ï¼š</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="ä»€éº¼æ˜¯ä¾è³´ç‚ºä»€éº¼è¦ç®¡ç†">ä»€éº¼æ˜¯ä¾è³´ï¼Œç‚ºä»€éº¼è¦ç®¡ç†ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä»€éº¼æ˜¯ä¾è³´ç‚ºä»€éº¼è¦ç®¡ç†">#</a></h2>
<blockquote>
<p>ä»»ä½•ä½ ä¸èƒ½æ§åˆ¶çš„ç‰©ä»¶ï¼Œéƒ½æ˜¯éš±è—çš„ä¾è³´</p>
</blockquote>
<p>å…·é«”ä¾†èªªï¼Œå¦‚æœç¨‹å¼å®Œå…¨ä¸å¯«æ¸¬è©¦ï¼Œé‚£éº¼å…¶å¯¦å°±ä¸ç”¨è€ƒæ…®ä¾è³´çš„å•é¡Œã€‚</p>
<p>è¦ç®¡ç†ä¾è³´çš„ç†ç”±åœ¨æ–¼çµ¦æ¸¬è©¦ä¸€å€‹ä»‹å…¥çš„é€”å¾‘ã€‚</p>
<p>ä¾‹å¦‚èªªæœ‰ä¸€å€‹ç‰©ä»¶æ˜¯ç”¨ä¾†è¿½è¹¤è–èª•è€äººï¼Œè£¡é¢åˆ¤æ–·ä»–æœ‰æ²’æœ‰ä¸Šç­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">SantaClausTracker</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">func</span> <span class="nf">isWorking</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">today</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">month</span> <span class="p">=</span> <span class="n">Calendar</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">components</span><span class="p">(.</span><span class="n">month</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">day</span> <span class="p">=</span> <span class="n">Calendar</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">components</span><span class="p">(.</span><span class="n">day</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">month</span> <span class="p">==</span> <span class="mi">12</span> <span class="o">&amp;&amp;</span> <span class="n">day</span> <span class="p">==</span> <span class="mi">25</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>é¡¯ç„¶ï¼Œè¦é€™å€‹æ–¹æ³•å›å‚³<code>true</code>çš„è©±ï¼Œå°±åªèƒ½åœ¨è–èª•ç¯€ç•¶å¤©é€²è¡Œæ¸¬è©¦ã€‚
å…¶ä»–æ—¥å­å›å‚³éƒ½æ˜¯<code>false</code>ã€‚</p>
<p>é€™å€‹æ–¹æ³•è£¡é¢æœ‰å…©å€‹ä¾è³´ï¼Œä¸€å€‹æ˜¯<code>Date()</code>ï¼Œå¦ä¸€å€‹å‰‡æ˜¯<code>Calendar.current</code>ã€‚
å¦‚æœæƒ³è¦æŠŠé€™äº›ä¾è³´è®Šå¾—å¯æ§ï¼Œé‚£éº¼å°±æ˜¯è¦é€éå¤–éƒ¨å‚³å…¥ã€‚ä¹Ÿå°±æ˜¯ä¾è³´æ³¨å…¥ï¼ˆdependency injectionï¼‰</p>
<p>å‚³çµ±çš„æ–¹æ³•æœ‰ä¸‰ï¼š</p>
<ol>
<li>å»ºæ§‹å­æ³¨å…¥</li>
<li>å±¬æ€§æ³¨å…¥</li>
<li>æ–¹æ³•åƒæ•¸æ³¨å…¥</li>
</ol>
<p>åç¨±æ‡‰è©²è¶³ä»¥æè¿°ç›¸å°æ‡‰çš„è¡Œç‚ºï¼Œå°±ä¸å¤šè´…è¿°äº†ã€‚</p>
<p>æ›è¨€ä¹‹ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œåªè¦æ˜¯<code>ä½¿ç”¨</code>çš„ç‰©ä»¶ï¼Œéƒ½è¦è¨˜å¾—å¯ä»¥æ›¿æ›ã€‚
èˆ‰å€‹ä¾‹å­</p>
<pre tabindex="0"><code>(X
func somefunction() {
    Date() 
}

(O
func somefunction(date: Date) {
    date 
}

(X
func somefunction() {
    URLSession.share
}

(ğŸ”º
func somefunction(session: URLSession) {
    session
}
</code></pre><p>é‚£éº¼ï¼Œé¡¯ç„¶æœƒå‡ºç¾çš„å•é¡Œå°±æ˜¯ã€Œ<strong>ä¾è³´è¦æ€éº¼ä¾†</strong>ã€</p>
<p>ä¾‹å¦‚èªªä¸€å€‹Appç•«é¢å †ç–Šæ˜¯é€™æ¨£</p>
<p><del>å…ˆä¸è¨è«–ç•«é¢å±¤ç´šå¤ªæ·±çš„å•é¡Œ</del>é€™å¯ä»¥çœ‹ä¸€å€‹ç²¾å½©çš„å½±ç‰‡ã€Œ<a href="https://www.ted.com/talks/david_pogue_simplicity_sells">è‡³ç°¡æš¢éŠ·</a>ã€</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
View1 --&gt; View2 --&gt; View3 --&gt; View4
</code></pre><p>ä»Šå¤©View4æœ‰å‘¼å«APIçš„éœ€è¦ï¼ŒView2 , 3æ²’æœ‰ã€‚
è¦present View4åªèƒ½å¤ éView3ï¼ˆMVCï¼‰æˆ–æ˜¯View3çš„Coordinatorï¼ˆMVVM Cï¼‰
å‹¢å¿…View2, 3éƒ½å¿…é ˆè¦æ”œå¸¶ä¸€å€‹ç”¨ä¸åˆ°çš„ç‰©ä»¶ã€‚</p>
<p>ç•¶ä»Šå¤©åº•å±¤è¶Šå¤šï¼Œä¾è³´æ‹†åˆ†çš„è¶Šç´°ï¼Œå°±ä¸­é–“çš„å±¤ç´šå°±å®¹æ˜“è¦å‚³éä¸€äº›ç”¨ä¸åˆ°çš„ç‰©ä»¶ã€‚</p>
<p><strong>ä¹…äº†å°±ä¸å®¹æ˜“ç¶­è­·ï¼Œä¸å®¹æ˜“ç¶­è­·å°±ç­‰æ–¼éš±è—çš„Bug</strong></p>
<p>ä»¥å‰å¯«éé¡ä¼¼çš„ç¨‹å¼ç¢¼ï¼Œä¸­é–“å‚³éçš„åƒæ•¸å¤šäº†ï¼Œå°±éœ€è¦ä½¿ç”¨DTOä¾†æ‰“åŒ…ï¼Œå¤šä¸€å±¤åˆé¡¯å¾—å†—ä½™ã€‚</p>
<p>é€™æ™‚å€™å°±çœ‹åˆ°ä¸€å€‹çªç ´å¤©éš›çš„æƒ³æ³•<a href="https://vimeo.com/291588126">How to control the World</a></p>
<p><strong>å¼·çƒˆå»ºè­°çœ‹å½±ç‰‡</strong></p>
<p><strong>å¼·çƒˆå»ºè­°çœ‹å½±ç‰‡</strong></p>
<p><strong>å¼·çƒˆå»ºè­°çœ‹å½±ç‰‡</strong></p>
<p>å…ˆä¾†çœ‹çœ‹å¯¦ä½œï¼ŒæŠŠéœ€è¦çš„ä¾è³´å®£å‘Šåœ¨ä¸€å€‹structä¸­</p>
<pre tabindex="0"><code>struct World {
  var date = { Date() }
}
</code></pre><blockquote>
<p>é€™é‚Šè¦æ³¨æ„çš„æ˜¯ä¸¦ä¸æ˜¯é€éã€Œæ–¹æ³•ã€ä¾†å–å€¼ï¼Œä¾‹å¦‚èªª
<code>func getDate() -&gt; Date { ... }</code>
å› ç‚ºæ–¹æ³•çš„å¯¦ä½œæ˜¯ä¸å¯ç•°å‹•çš„ï¼Œæœ¬è³ªä¸Šé‚„æ˜¯ä¾è³´ï¼Œåªæ˜¯æŠŠä¾è³´é›†ä¸­åˆ°ä¸€å€‹åœ°æ–¹ç®¡ç†ã€‚</p>
<p>ä¹Ÿä¸æ˜¯ç›´æ¥æ˜¯ä¸€å€‹Dateå±¬æ€§
å› ç‚ºç•¶ä½ å­˜å–Current.dateæ™‚ï¼Œæ¯æ¬¡å–çš„éƒ½æ˜¯ä¸ä¸€æ¨£çš„å€¼
å¦‚æœæƒ³è¦æ¯æ¬¡éƒ½å–å¾—åŒä¸€å€‹æ™‚é–“çš„è©±ï¼Œå°±åšä¸åˆ°é€™å€‹éœ€æ±‚</p>
<p>ç•¶ç„¶é€™é‚Šä¹Ÿå¯ä»¥æŠŠé€™å€‹<code>struct</code>æ”¹å¯«æˆ<code>protocol</code>ï¼Œç„¶å¾Œå¯¦ä½œä¸åŒçš„ç‰©ä»¶ä¾†æä¾›ä¸åŒçš„æ¸¬è©¦éœ€è¦ï¼Œä¸éé‚£å°±æ˜¯å¦å¤–ä¸€å›äº‹äº†ã€‚</p>
</blockquote>
<p>èªªå›æ­£é¡Œï¼Œç•¶ä½ å®£å‘Šäº†é€™æ¨£çš„<code>struct</code>ï¼Œä½ é‚„éœ€è¦ä¸€å€‹<strong>å…¨åŸŸ</strong>çš„<strong>è®Šæ•¸</strong></p>
<pre tabindex="0"><code>var Current = World()
</code></pre><blockquote>
<p>é€™æ˜¯ä¸€å€‹<code>Singleton</code>ï¼<del>çš®è«¾å¯ï¼Œé€™å€‹ç›´æ¥é›»æ­»</del></p>
</blockquote>
<p>åˆ¥æ€¥ï¼Œé€™æ™‚å€™é€™å€‹è¨­è¨ˆç¥çš„åœ°æ–¹ä¾†äº†ã€‚</p>
<p>ç”¨ä¸Šé¢çš„ç¯„ä¾‹ä¾†å¯¦ä½œçš„è©±å°±æœƒè®Šé€™æ¨£</p>
<pre tabindex="0"><code>struct SantaClusTracker {
  
  func isWorking() -&gt; Bool {
    //æš«æ™‚å…ˆæ”¹ä¸€å€‹ï¼Œbaby step
    let today = Current.date()
    let month = Calendar.current.components(.month, today)
    let day = Calendar.current.components(.day, today)
    return month == 12 &amp;&amp; day == 25
  }

}
</code></pre><p>å› ç‚º<code>Current</code>æ˜¯ä¸€å€‹<code>var</code>ï¼Œæ‰€ä»¥è£¡é¢çš„å±¬æ€§æ˜¯å¯ä»¥ç•°å‹•çš„ã€‚
å› ç‚º<code>date</code>æ˜¯ä¸€å€‹<code>å›å‚³Dateçš„function</code>ï¼Œæ‰€ä»¥å¯¦ä½œå…§å®¹ä¹Ÿæ˜¯å¯ä»¥ç•°å‹•çš„</p>
<p>ä»Šå¤©éœ€è¦æ¸¬è©¦çš„æ™‚å€™ï¼Œå¯ä»¥ç›´æ¥å°<code>Current</code>è¨­å€¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">test_Date_Is_Christmas_SantaClausTracker_isWorking_should_return_true</span><span class="p">()</span> <span class="kr">throws</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* 3AåŸå‰‡ï¼Œå…·é«”å¯ä»¥åƒè€ƒ91çš„æ–‡ç« æˆ–æ˜¯è½ä»–çš„èª²ï¼ç²ç›Šè‰¯å¤š */</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//Arrange</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nv">target</span> <span class="p">=</span> <span class="n">SantaClausTracker</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">Current</span><span class="p">.</span><span class="n">date</span> <span class="p">=</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">     <span class="kd">let</span> <span class="nv">formatter</span> <span class="p">=</span> <span class="n">DateFormatter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">     <span class="n">formatter</span><span class="p">.</span><span class="n">dateFormat</span> <span class="p">=</span> <span class="s">&#34;yyyy/MM/dd&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="n">formatter</span><span class="p">.</span><span class="n">date</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="s">&#34;2021/12/25&#34;</span><span class="p">)</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">//Action</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nv">actual</span> <span class="p">=</span> <span class="n">target</span><span class="p">.</span><span class="n">isWorking</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">//Assert</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nv">expect</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expect</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æ­¤ï¼Œå°±ç®—æ˜¯åœ¨å…¶ä»–æ—¥å­ï¼Œä¹Ÿèƒ½æª¢æŸ¥åœ¨è–èª•ç¯€çš„æ™‚å€™æ˜¯ä¸æ˜¯æœƒå›å‚³<code>true</code></p>
<p>é€™é‚Šå…ˆè¨è«–å¹¾å€‹å•é¡Œ</p>
<ol>
<li>Singletonä¸æ˜¯ä¸å¥½ï¼Œç‚ºä»€éº¼è¦ç”¨ï¼Ÿ</li>
<li>ç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹ï¼Ÿ</li>
<li>å…¨åŸŸè®Šæ•¸å¾ˆå±éšªï¼Œä¸æ‡‰è©²ç”¨ä¸æ˜¯å—ï¼Ÿ</li>
</ol>
<h3 id="singletonä¸æ˜¯ä¸å¥½ç‚ºä»€éº¼è¦ç”¨">Singletonä¸æ˜¯ä¸å¥½ï¼Œç‚ºä»€éº¼è¦ç”¨ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#singletonä¸æ˜¯ä¸å¥½ç‚ºä»€éº¼è¦ç”¨">#</a></h3>
<p>Singletonä¸¦ä¸æ˜¯ä¸å¥½ï¼Œä¸å¥½çš„è©±Appleé‚„åˆ°è™•æ”¾ä¸æ˜¯å¾ˆå¥‡æ€ªï¼Ÿ</p>
<p><code>URLSession.shared</code></p>
<p><code>UserDefaults.standard</code></p>
<p><code>FileManager.default</code></p>
<p>Singletonçš„å•é¡Œåœ¨æ–¼å®ƒæ˜¯ä¸€å€‹å¯¦é«”å‹åˆ¥ï¼Œç„¡æ³•è¢«æŠ½è±¡åŒ–ã€‚ä¹Ÿå°±æ˜¯ç„¡æ³•åœ¨æ¸¬è©¦ä¸­è¢«æ›¿æ›ã€‚ç•¶ä½ ä»Šå¤©åœ¨ç¨‹å¼ç¢¼ä¸­æ”¾äº†<code>URLSession.shared</code>ä»¥å¾Œï¼Œå°±è¨»å®šäº†ä»–ä¸€å®šæœƒå»èµ°çœŸå¯¦çš„ç¶²è·¯ï¼ˆç”¨intercepteræ“‹æ‰å¦ç•¶åˆ¥è«–ï¼‰ï¼Œè€Œæ²’è¾¦æ³•ç”¨<code>MockURLSession</code>ä¾†é€²è¡Œæ›¿æ›</p>
<h3 id="ç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹">ç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ç‚ºä»€éº¼ä¸ç”¨ä»‹é¢éš”é–‹">#</a></h3>
<p>åœ¨çœ‹é€™å€‹å½±ç‰‡ä¹‹å‰ï¼Œæˆ‘ä¹Ÿæ˜¯ç”¨<code>protocol</code>ä¾†é€²è¡Œå€éš”ï¼Œé€™ä¹Ÿæœ‰ä¸€å€‹å¤§ç¥çš„æ–‡ç« å¯ä»¥åƒè€ƒ<a href="https://www.codementor.io/koromiko/unit-test-for-networking-ahdpdqr5k">æ­¡è¿ä¾†åˆ°çœŸå¯¦ä¸–ç•Œ</a></p>
<p>å…ˆä¾†è«‡è«‡å¦‚æœç”¨ä»‹é¢éš”é–‹URLSessionï¼Œè¦åšå¤šå°‘å‹•ä½œï¼Ÿ</p>
<ol>
<li>è£½ä½œä¸€å€‹ä»‹é¢<code>URLSessionProtocol</code>ï¼Œæ–¹æ³•ç°½ç« è¦è·ŸURLSessionä¸­è¦å‘¼å«çš„æ–¹æ³•ä¸€è‡´</li>
<li>è®“URLSessionæ“´å……<code>URLSessionProtocol</code>ï¼Œå› ç‚ºæ–¹æ³•å·²ç¶“å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ç”¨å¦å¤–å¯¦ä½œã€‚</li>
<li>è£½ä½œä¸€å€‹æ¸¬è©¦åœ¨ç”¨çš„ç‰©ä»¶<code>MockURLSession</code>ï¼Œå¯¦ä½œä»‹é¢<code>URLSessionProtocol</code>ï¼Œè£¡é¢ä¸æ¶‰åŠç¶²è·¯å­˜å–ï¼Œç›´æ¥å›å‚³å€¼ã€‚</li>
<li>å°‡åŸæœ¬ç¨‹å¼ç¢¼å‘¼å«<code>URLSession.shared</code>çš„åœ°æ–¹å…¨éƒ¨æŠ½æ›æ‰</li>
<li>åœ¨æ¸¬è©¦ä¸­å°‡<code>MockURLSession</code>æ³¨å…¥åˆ°æ¸¬è©¦ç›®æ¨™ä¸­</li>
</ol>
<p>é¦–å…ˆï¼Œé€™å€‹åšæ³•å°ç¨‹å¼ç¢¼æ”¹å‹•å¹…åº¦æ¯”è¼ƒå¤§ï¼Œç•¶æ—©æœŸæ²’åšï¼Œå¾Œé¢è¦æŠ½æ›çš„æ™‚å€™æ”¹å‹•å¹…åº¦å°±æœƒå¾ˆå¤§ï¼Œä¹Ÿæ˜¯å­˜åœ¨é¢¨éšªã€‚</p>
<p>å…¶æ¬¡ï¼Œå¦‚æœä»‹é¢è£¡é¢çš„æ–¹æ³•é–‹å§‹è®Šå¤šä»¥å¾Œï¼Œä¸€å€‹æ–°çš„Mockç‰©ä»¶å¯¦ä½œèµ·ä¾†ä¸å®¹æ˜“ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚èªªä¸€å€‹è³‡æ–™åº«å­˜å–ä»‹é¢ï¼Œæœ‰å››å€‹æ–¹æ³•CRUD</p>
<p>é‚£éº¼å»ºç«‹ä¸€å€‹æ–°çš„Mockç‰©ä»¶å°±è¦å¯¦ä½œå››å€‹æ–¹æ³•ã€‚</p>
<p>è€Œä¸€å€‹æ­£å¸¸çš„ä»‹é¢æ–¹æ³•éƒ½ä¸æ­¢å››å€‹</p>
</blockquote>
<h3 id="å…¨åŸŸè®Šæ•¸å¾ˆå±éšªä¸æ‡‰è©²ç”¨ä¸æ˜¯å—">å…¨åŸŸè®Šæ•¸å¾ˆå±éšªï¼Œä¸æ‡‰è©²ç”¨ä¸æ˜¯å—ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å…¨åŸŸè®Šæ•¸å¾ˆå±éšªä¸æ‡‰è©²ç”¨ä¸æ˜¯å—">#</a></h3>
<p>å…¨åŸŸè®Šæ•¸çš„å±éšªä¹‹è™•åœ¨æ–¼ã€Œ<strong>ä½ ä¸çŸ¥é“ä»€éº¼æ™‚å€™è¢«æ”¹å‹•</strong>ã€</p>
<p>èª ç„¶ï¼Œè¨­å®šç‚ºè®Šæ•¸æ˜¯å­˜åœ¨é¢¨éšªçš„ï¼Œä½†æ˜¯ä¸æ‡‰è©²æŠŠ<code>Current</code>ç•¶æˆæ˜¯ä¸€å€‹å‚³éã€æš«å­˜åƒæ•¸çš„åœ°æ–¹ã€‚è€Œæ˜¯ä¸€å€‹ä¾è³´ä¿ç®¡å€ï¼ˆProductionæ™‚ï¼‰ã€ä¾è³´æ³¨å…¥å€ï¼ˆDevelopæ™‚ï¼‰</p>
<p>èªªå›é€™å€‹æ–¹æ³•</p>
<p>å¦‚æœä»Šå¤©è¦æ¸¬è©¦ä½¿ç”¨è€…ç™»å…¥ã€Œ<strong>æˆåŠŸ</strong>ã€èˆ‡ã€Œ<strong>å¤±æ•—</strong>ã€çš„æƒ…å¢ƒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">UserAPIClient</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">complectionHandler</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="nb">Bool</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="s">&#34;API Path&#34;</span><span class="p">)</span><span class="o">!</span> <span class="c1">// &lt;-- é€™è£¡ä¸€å®šrun time error</span>
</span></span><span class="line"><span class="cl">        <span class="n">URLSession</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">dataTask</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="kc">_</span><span class="p">,</span> <span class="kc">_</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">            <span class="n">complectionHandler</span><span class="p">(</span><span class="n">data</span> <span class="p">==</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">ContentView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">loginResult</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Text</span><span class="p">(</span><span class="s">&#34;Login </span><span class="si">\(</span><span class="n">loginResult</span> <span class="p">?</span> <span class="s">&#34;Success&#34;</span> <span class="p">:</span> <span class="s">&#34;Failure&#34;</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">onAppear</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">UserAPIClient</span><span class="p">().</span><span class="n">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="s">&#34;account&#34;</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="s">&#34;password&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">                    <span class="n">loginResult</span> <span class="p">=</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>UserAPIClient</code>æœ‰ä¸€å€‹ä¸€å®šæœƒåœ¨run timeç‚¸æ‰çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯<code>URL(string: &quot;API Path&quot;)!</code></p>
<p>å‡æƒ³é€™æ˜¯Serveræš«æ™‚ä¸å¯ç”¨ï¼Œæˆ–æ˜¯ç¶²è·¯æ–·ç·šçš„æƒ…å¢ƒå§ã€‚</p>
<p>é‚£é€™ç¨®æ™‚å€™å°±ä¸ç”¨æ¸¬è©¦äº†å—ï¼Ÿæ²’éŒ¯ï¼<del>å¾Œå°ä¿®å¥½å†å«æˆ‘</del></p>
<p>ç•¶ç„¶ä¸å¯èƒ½ï¼Œæ‰€ä»¥é€™æ™‚å€™å°±éœ€è¦è„«é›¢å¯¦éš›ç’°å¢ƒä¾†æ¸¬è©¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚</p>
<p>ç”¨<code>protocol</code>çš„æ–¹å¼ä¾†é€²è¡Œè„«é‰¤æ˜¯é€™æ¨£å¯¦ä½œçš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="c1">//1. å®šç¾©å”è­°</span>
</span></span><span class="line"><span class="cl"><span class="kd">protocol</span> <span class="nc">UserAPIClientProtocol</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">func</span> <span class="nf">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">complectionHandler</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="nb">Bool</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//2. è®“åŸæœ¬çš„ç‰©ä»¶æ“´å……é€™å€‹å”è­°</span>
</span></span><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">UserAPIClient</span><span class="p">:</span> <span class="n">UserAPIClientProtocol</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//3. å»ºç«‹æ¸¬è©¦ç‰©ä»¶ï¼Œå› ç‚ºæ¸¬è©¦æƒ…å¢ƒæœ‰ã€ŒæˆåŠŸã€ã€Œå¤±æ•—ã€ï¼Œæ‰€ä»¥å›å‚³å€¼ç”¨å»ºæ§‹æ³¨å…¥</span>
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">MockUserAPIClient</span><span class="p">:</span> <span class="n">UserAPIClientProtocol</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">loginResult</span><span class="p">:</span> <span class="nb">Bool</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">func</span> <span class="nf">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">complectionHandler</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="nb">Bool</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">complectionHandler</span><span class="p">(</span><span class="n">loginResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//4. å°‡åŸæœ¬çš„å‹åˆ¥ç”¨ä»‹é¢æŠ½æ›ï¼ˆå‘¼å«çš„æ™‚å€™è¦æ³¨å…¥ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">ContentView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">userAPIClient</span><span class="p">:</span> <span class="n">UserAPIClientProtocol</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">loginResult</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Text</span><span class="p">(</span><span class="s">&#34;Login </span><span class="si">\(</span><span class="n">loginResult</span> <span class="p">?</span> <span class="s">&#34;Success&#34;</span> <span class="p">:</span> <span class="s">&#34;Failure&#34;</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">onAppear</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">userAPIClient</span><span class="p">.</span><span class="n">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="s">&#34;acc&#34;</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="s">&#34;pass&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">                    <span class="n">loginResult</span> <span class="p">=</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//5. ä¿®æ”¹å‘¼å«ç«¯</span>
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">ContentView_Previews</span><span class="p">:</span> <span class="n">PreviewProvider</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ContentView</span><span class="p">(</span><span class="n">userAPIClient</span><span class="p">:</span> <span class="n">MockUserAPIClient</span><span class="p">(</span><span class="n">loginResult</span><span class="p">:</span> <span class="kc">true</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æœç”¨Worldä¾†æ§åˆ¶çš„è©±ï¼Œæ˜¯é€™å€‹æ¨£å­çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">UserAPI</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">login</span> <span class="p">=</span> <span class="n">UserAPIClient</span><span class="p">().</span><span class="n">login</span><span class="p">(</span><span class="n">account</span><span class="p">:</span><span class="n">password</span><span class="p">:</span><span class="n">complectionHandler</span><span class="p">:)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">World</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">userAPI</span> <span class="p">=</span> <span class="n">UserAPI</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nv">Current</span> <span class="p">=</span> <span class="n">World</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">ContentView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">loginResult</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Text</span><span class="p">(</span><span class="s">&#34;Login </span><span class="si">\(</span><span class="n">loginResult</span> <span class="p">?</span> <span class="s">&#34;Success&#34;</span> <span class="p">:</span> <span class="s">&#34;Failure&#34;</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">onAppear</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Current</span><span class="p">.</span><span class="n">userAPI</span><span class="p">.</span><span class="n">login</span><span class="p">(</span><span class="s">&#34;account&#34;</span><span class="p">,</span> <span class="s">&#34;password&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">                    <span class="n">loginResult</span> <span class="p">=</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ä¿®æ”¹å‘¼å«ç«¯</span>
</span></span><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">ContentView_Previews</span><span class="p">:</span> <span class="n">PreviewProvider</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ­£å¸¸ä¸æœƒåœ¨é€™é‚Šä¿®æ”¹ï¼Œé€™é‚Šåªæ˜¯æ‡¶å¾—æŠŠè³‡æ–™åˆ‡ä¹¾æ·¨æ‰€ä»¥æ”¾è‘—èˆ‰ä¾‹ä¸€ä¸‹</span>
</span></span><span class="line"><span class="cl">        <span class="n">Current</span><span class="p">.</span><span class="n">userAPI</span><span class="p">.</span><span class="n">login</span> <span class="p">=</span> <span class="p">{</span> <span class="kc">_</span><span class="p">,</span> <span class="kc">_</span><span class="p">,</span> <span class="n">callback</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">            <span class="n">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ContentView</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>çœ‹èµ·ä¾†æœ‰é»å·®ç•°ï¼Œä½†æ˜¯å¥½åƒåˆå·®ç•°ä¸å¤§ï¼Ÿ
ç•¶ä½ å†é‡åˆ°é€™æ¨£çš„éœ€æ±‚æ™‚</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
View1 --&gt; View2 --&gt; View3 --&gt; View4
</code></pre><p>View2, 3å°±ä¸éœ€è¦æ”œå¸¶<code>UserAPIClient</code>è·‘ä¾†è·‘å»äº†</p>
<p><strong>æœ€é‡è¦çš„æ˜¯</strong>
ç•¶ä½ çš„æ¸¬è©¦æƒ…å¢ƒéœ€è¦ä¸åŒçš„å›å‚³å€¼æ™‚ï¼Œä¸å†éœ€è¦åƒä¸Šé¢çš„<code>MockUserAPIClient</code>ä¸€æ¨£é€éå„ç¨®æ³¨å…¥ï¼Œè€ƒæ…®å„ç¨®æ¸¬è©¦æƒ…å¢ƒè¦å‘¼å«æ–¹æ³•æ™‚çš„é€šç”¨æ€§ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥é‡å°ç‰¹å®šæ–¹æ³•æ”¹å¯«æ–¹æ³•å¯¦ä½œå…§å®¹ã€‚</p>
<h2 id="åƒè€ƒæ–‡ç« ">åƒè€ƒæ–‡ç« ï¼š<a hidden class="anchor" aria-hidden="true" href="#åƒè€ƒæ–‡ç« ">#</a></h2>
<p><a href="https://vimeo.com/291588126">https://vimeo.com/291588126</a></p>
<p><a href="https://www.codementor.io/koromiko/unit-test-for-networking-ahdpdqr5k">https://www.codementor.io/koromiko/unit-test-for-networking-ahdpdqr5k</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/swift/">Swift</a></li>
      <li><a href="/tags/dependency/">Dependency</a></li>
      <li><a href="/tags/global-variable/">Global Variable</a></li>
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="/">Insidehand</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
